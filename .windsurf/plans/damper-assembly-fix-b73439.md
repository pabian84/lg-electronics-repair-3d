# 댐퍼 커버 조립 좌표 오류 분석 및 수정 계획

댐퍼 커버 조립 시 발생하는 좌표 오차 원인을 분석하고, 월드 좌표계 기반의 정밀 이동 로직으로 전환하여 애니메이션 문제를 해결합니다.

## 1. 현재 좌표 데이터 분석 및 문제점
제공해주신 콘솔 로그를 분석한 결과 다음과 같은 심각한 문제가 확인됩니다.

- **이동 거리의 불일치 (월드 vs 로컬)**
    - **World 이동량**: `targetWorldPos - currentCoverWorldPos`
        - X: `0.00000156`, Y: `0.00000691`, Z: `0.00000610` (거의 **0.00001 단위**의 극소량)
    - **Local 이동량**: `targetPosition - currentCoverPos`
        - X: `0.0032`, Y: `0.0054`, Z: `0.0069` (약 **0.005 단위**, 월드보다 500배 큼)
- **원인 추정**: 
    1. `parentNode.worldToLocal` 변환 시 부모 객체에 **매우 작은 스케일(Scale)**이 적용되어 있을 가능성이 높습니다.
    2. `targetPosition`을 계산할 때 사용되는 `moveDelta`가 월드 좌표계의 차이값인데, 이를 로컬 좌표인 `currentCoverPos`에 직접 더하는 방식은 부모의 변환(Rotation, Scale)이 있을 경우 오류를 발생시킵니다.

## 2. 개선 계획

### 1단계: 분석 로직 개선
- `plugAnalyses` 결과를 즉시 월드 좌표로 변환하여 모든 매칭 계산을 월드 좌표계에서 수행합니다.
- 부모의 스케일이나 회전에 영향을 받지 않도록 로컬 좌표 계산을 최소화합니다.

### 2단계: 애니메이션 로직 전환
- `coverNode.position`을 직접 타겟팅하는 대신, 이전 시도에서 제안했던 `animState` (월드 좌표 객체) 방식을 다시 적용합니다.
- 매 프레임마다 `parentNode.worldToLocal`을 호출하여 월드 좌표를 현재 시점의 로컬 좌표로 정확히 변환하여 주입합니다.

### 3단계: 정밀도 및 예외 처리
- 이동 거리가 너무 짧을 경우(현재 로그처럼)에 대비하여 최소 이동 보장 로직을 검토합니다.
- 메타데이터의 `offset`이나 `depth`가 월드 좌표계 기준으로 정확히 적용되는지 재검증합니다.

## 3. 기대 효과
- 부모 노드의 복잡한 변환(Scale, Rotation)에 관계없이 정확한 조립 위치로 이동합니다.
- 시각적으로 확인하기 어려웠던 극소량의 이동 문제를 해결합니다.
